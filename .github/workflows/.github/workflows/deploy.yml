#!/bin/bash

# ===========================
# Script de dÃ©ploiement TGST
# ===========================

echo "ğŸ”¹ DÃ©ploiement TGST - Phase 1 : Clone du repo"
git clone https://github.com/Johny-1992/TGST.git
cd TGST || { echo "Erreur : dossier TGST introuvable"; exit 1; }

echo "ğŸ”¹ Installation des dÃ©pendances Node.js"
yarn install || { echo "Erreur lors de l'installation"; exit 1; }

echo "ğŸ”¹ VÃ©rification du fichier .env"
if [ ! -f ".env" ]; then
    echo "âš ï¸ Attention : .env introuvable. CrÃ©ez-le avec vos variables secrÃ¨tes."
else
    echo ".env dÃ©tectÃ© âœ…"
fi

echo "ğŸ”¹ DÃ©ploiement Render"
render service create \
  --name tgst-backend \
  --type web \
  --env node \
  --branch main \
  --build-command "yarn install" \
  --start-command "node server.js"

echo "ğŸ”¹ DÃ©ploiement Cloudflare Worker"
if ! command -v wrangler &> /dev/null; then
    echo "Wrangler non installÃ©, installation en cours..."
    npm install -g wrangler
fi

wrangler publish || { echo "Erreur Cloudflare Worker"; exit 1; }

echo "ğŸ‰ DÃ©ploiement terminÃ© !"
echo "Backend TGST Render : https://tgst-1.onrender.com"
echo "Worker Cloudflare : https://<TON_WORKER>.workers.dev"

echo "ğŸ’¡ TGST est maintenant en ligne et visible partout"
